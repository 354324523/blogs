import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as a,o as s,c as l,d as e,f as o,b as r,e as i}from"./app-DWz5k_-z.js";const d={},c=i(`<h2 id="rdb快照" tabindex="-1"><a class="header-anchor" href="#rdb快照"><span>RDB快照</span></a></h2><blockquote><p>RDB快照是什么</p></blockquote><p>RDB快照是记录某一瞬间的内存数据，记录的是实际数据（<strong>二进制数据</strong>），而AOF文件记录的是命令的操作日志（<strong>操作日志</strong>），而不是实际数据。因此在Redis恢复数据时，RDB恢复数据的效率会比AOF高，因为RDB是直接将二进制文件读入内存就可以了，不需要像AOF那样还需要额外执行操作命令的步骤才能恢复数据。</p><blockquote><p>RDB快照如何使用</p></blockquote><p>Redis提供了两个命令来生成RDB文件，分别是<code>save</code>和<code>bgsave</code>，他们的区别就是是否在「主线程」里执行：</p><ul><li>执行了save命令，就会在主线程生成RDB文件，由于和执行命令在同一个线程，所以如果写入RDB文件的时间过久，<strong>会阻塞主线程</strong>；</li><li>执行了bgsave命令，会创建一个子进程来生成RDB文件，这样可以<strong>避免主线程阻塞</strong>；</li></ul><p>RDB文件加载是在服务器启动时自动执行，Redis并未提供专门用于加载RDB文件的命令。</p><p>Redis还可以通过修改配置文件选项来实现每隔一段时间自动执行一次bgsave命令，默认配置如下：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>save 900 1  # 900秒内，对数据库进行了至少1次修改就会执行bgsave；
save 300 10  # 300秒内，对数据库进行了至少10次修改就会执行bgsave；
save 60 10000  # 60秒内对数据库进行了至少10000次修改就会执行bgsave；
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis的快照是全量快照，每次执行时都会把内存中的所有数据记录到磁盘。所以可以认为执行快照是一个比较重的操作，如果执行太频繁可能对Redis性能产生影响，如果频率太低，服务器故障时又会丢失很多数据。</p><h2 id="执行快照期间-数据能被修改吗" tabindex="-1"><a class="header-anchor" href="#执行快照期间-数据能被修改吗"><span>执行快照期间，数据能被修改吗？</span></a></h2><h2 id="aof文件可以保存rdb格式吗-rdb-和-aof-合体" tabindex="-1"><a class="header-anchor" href="#aof文件可以保存rdb格式吗-rdb-和-aof-合体"><span>AOF文件可以保存RDB格式吗?(RDB 和 AOF 合体)</span></a></h2><blockquote><p>RDB持久化与AOF持久化的优缺点</p></blockquote><ul><li>AOF持久化机器宕机时丢失数据少，但是重启Redis时恢复数据较慢</li><li>RDB持久化重启Redis时恢复数据较快，但是机器宕机时丢失数据较多</li></ul><blockquote><p>混合持久化</p></blockquote><p>在Redis4.0版本之后，提出了混合使用AOF日志和RDB快照，该方法又叫混合持久化。</p><p>混合持久化工作在<strong>AOF日志重写的过程</strong>。当开启了混合持久化时，fork出来的重写子进程会先将与主进程共享的内存数据以RDB方式写入到AOF文件。Redis 后台子进程重写 AOF 期间，主线程处理的操作命令都会被记录在重写缓冲区，重写缓冲区里的增量命令会以AOF方式写入到AOF文件，写入完成后通知主进程将新的含有RDB格式和AOF格式的AOF文件替换旧的AOF文件。</p><p>也就是说使用了混合持久化的AOF文件<strong>前半部分说RDB格式的全量数据，后半部分是AOF格式的增量数据</strong>。这样在Redis重启加载数据的时候，由于前半部分是RDB格式的，这样<strong>加快加载速度</strong>，加载完RDB的内容后在加载后半部部分的AOF内容，这样<strong>减少数据丢失</strong>。</p><h4 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接"><span>参考链接：</span></a></h4>`,19),p={href:"https://blog.csdn.net/zjj2006/article/details/109216591",target:"_blank",rel:"noopener noreferrer"},R={href:"https://segmentfault.com/a/1190000041572572",target:"_blank",rel:"noopener noreferrer"};function B(D,h){const t=a("ExternalLinkIcon");return s(),l("div",null,[c,e("blockquote",null,[e("p",null,[e("a",p,[o("AOF 文件可以保存 RDB 格式吗"),r(t)])]),e("p",null,[e("a",R,[o("Redis中的缓冲区了解吗"),r(t)])])])])}const b=n(d,[["render",B],["__file","RDB持久化.html.vue"]]),m=JSON.parse('{"path":"/redis/%E6%8C%81%E4%B9%85%E5%8C%96%E7%AF%87/RDB%E6%8C%81%E4%B9%85%E5%8C%96.html","title":"RDB持久化","lang":"zh-CN","frontmatter":{"title":"RDB持久化","order":2,"category":["Redis"],"description":"RDB快照 RDB快照是什么 RDB快照是记录某一瞬间的内存数据，记录的是实际数据（二进制数据），而AOF文件记录的是命令的操作日志（操作日志），而不是实际数据。因此在Redis恢复数据时，RDB恢复数据的效率会比AOF高，因为RDB是直接将二进制文件读入内存就可以了，不需要像AOF那样还需要额外执行操作命令的步骤才能恢复数据。 RDB快照如何使用 R...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/blogs/redis/%E6%8C%81%E4%B9%85%E5%8C%96%E7%AF%87/RDB%E6%8C%81%E4%B9%85%E5%8C%96.html"}],["meta",{"property":"og:site_name","content":"皮卡丘"}],["meta",{"property":"og:title","content":"RDB持久化"}],["meta",{"property":"og:description","content":"RDB快照 RDB快照是什么 RDB快照是记录某一瞬间的内存数据，记录的是实际数据（二进制数据），而AOF文件记录的是命令的操作日志（操作日志），而不是实际数据。因此在Redis恢复数据时，RDB恢复数据的效率会比AOF高，因为RDB是直接将二进制文件读入内存就可以了，不需要像AOF那样还需要额外执行操作命令的步骤才能恢复数据。 RDB快照如何使用 R..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"皮卡丘"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RDB持久化\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"皮卡丘\\",\\"url\\":\\"https://www.baidu.com\\"}]}"]]},"headers":[{"level":2,"title":"RDB快照","slug":"rdb快照","link":"#rdb快照","children":[]},{"level":2,"title":"执行快照期间，数据能被修改吗？","slug":"执行快照期间-数据能被修改吗","link":"#执行快照期间-数据能被修改吗","children":[]},{"level":2,"title":"AOF文件可以保存RDB格式吗?(RDB 和 AOF 合体)","slug":"aof文件可以保存rdb格式吗-rdb-和-aof-合体","link":"#aof文件可以保存rdb格式吗-rdb-和-aof-合体","children":[]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":3,"words":900},"filePathRelative":"redis/持久化篇/RDB持久化.md","excerpt":"<h2>RDB快照</h2>\\n<blockquote>\\n<p>RDB快照是什么</p>\\n</blockquote>\\n<p>RDB快照是记录某一瞬间的内存数据，记录的是实际数据（<strong>二进制数据</strong>），而AOF文件记录的是命令的操作日志（<strong>操作日志</strong>），而不是实际数据。因此在Redis恢复数据时，RDB恢复数据的效率会比AOF高，因为RDB是直接将二进制文件读入内存就可以了，不需要像AOF那样还需要额外执行操作命令的步骤才能恢复数据。</p>\\n<blockquote>\\n<p>RDB快照如何使用</p>\\n</blockquote>\\n<p>Redis提供了两个命令来生成RDB文件，分别是<code>save</code>和<code>bgsave</code>，他们的区别就是是否在「主线程」里执行：</p>","autoDesc":true}');export{b as comp,m as data};
